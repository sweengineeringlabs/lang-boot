apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Metadata
metadata:
  name: rustboot-development
  annotations:
    config.kubernetes.io/local-config: "true"

# Base configuration
bases:
- ../../base

# Namespace override
namespace: development

# Name prefix for resources
namePrefix: dev-

# Common labels for development
commonLabels:
  environment: development
  app.kubernetes.io/version: dev

# Common annotations
commonAnnotations:
  environment: "development"
  managed-by: "kustomize"

# Image overrides
images:
- name: rustboot-app
  newName: rustboot-app
  newTag: dev-latest

# Replicas override (fewer replicas in dev)
replicas:
- name: rustboot-app
  count: 1

# Patches for development environment
patches:
- patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: rustboot-app
    spec:
      template:
        spec:
          containers:
          - name: rustboot-app
            env:
            - name: APP_ENV
              value: "development"
            - name: RUST_LOG
              value: "debug"
            - name: LOG_LEVEL
              value: "debug"
            # Relaxed resource limits for development
            resources:
              requests:
                memory: "64Mi"
                cpu: "50m"
              limits:
                memory: "256Mi"
                cpu: "250m"
            # Faster probe intervals for development
            livenessProbe:
              initialDelaySeconds: 10
              periodSeconds: 5
            readinessProbe:
              initialDelaySeconds: 5
              periodSeconds: 3
            startupProbe:
              initialDelaySeconds: 0
              periodSeconds: 2
              failureThreshold: 10

# ConfigMap overrides
configMapGenerator:
- name: rustboot-config
  behavior: merge
  literals:
  - APP_ENV=development
  - LOG_LEVEL=debug
  - LOG_FORMAT=pretty
  - RATE_LIMIT_ENABLED=false
  - CORS_ALLOW_ORIGINS=http://localhost:3000,http://localhost:8080
  - DATABASE_POOL_MAX_CONNECTIONS=5
  - METRICS_ENABLED=true

# Development-specific resources
resources:
- ingress.yaml
